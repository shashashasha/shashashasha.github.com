<html>
<head>
	<title></title>
    <link rel="stylesheet" type="text/css" href="css/style.css" />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
	<script src="lib/d3.js"></script>
	<script src="lib/d3.geom.js"></script>
    <script src="js/mesh.js"></script>
    <script src="js/map.js"></script>
    <script src="js/meshu.js"></script>
</head>
<body>
    <h2>meshu</h2>
    <input type="text" id="coords" />
    <div id="submit" class="button">click me rawr</div>
    <div id="output" class="button">click to output</div>
    <div id="cases"></div>

    <div class="frame"></div>
    <div id="places"></div>

    <script type="text/javascript">

        $(function() {
            var meshu = sb.meshu($("#map")[0]);

        	var hash = window.location.hash,
        		token = hash.split('=').pop(),
        		api = "https://api.foursquare.com/v2/users/self/checkins?oauth_token={token}&v={v}&limit=250",
        		url = api.replace('{token}', token).replace('{v}', '20120102');

        	$.ajax({
        		url: url,
        		dataType: 'json',
        		success: function(data) {
                    var checkins = data.response.checkins.items;
                    var locations = [];

                    $.each(checkins, function(i, e) {
                        var pt = [lon(parseFloat(e.venue.location.lng)), lat(e.venue.location.lat)];
                        var location = {
                            lat: e.venue.location.lat,
                            lon: e.venue.location.lng,
                            name: e.venue.name
                        };

                        locations.push(location);
                    });

                    console.log('points loaded:', locations);
                    meshu.locations(locations);
                }
        	});
        });

    </script>
</body>
</html>