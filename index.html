<html>
<head>
	<title></title>
    <link rel="stylesheet" src="css/style.css" />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
	<script src="js/d3.js"></script>
	<script src="js/d3.geom.js"></script>
</head>
<body>

<script type="text/javascript">

$(function() {
	var hash = window.location.hash,
		token = hash.split('=').pop(),
		api = "https://api.foursquare.com/v2/users/self/checkins?oauth_token={token}&v={v}&limit=250",
		url = api.replace('{token}', token).replace('{v}', '20111204');

	$.ajax({
		url: url,
		dataType: 'json',
		success: function(data) {
            var checkins = data.response.checkins.items;

            points = [];

            var lat = d3.scale.linear()
                        .domain([37.8,37])
                        .range([0,600]);
            var lon = d3.scale.linear()
                        .domain([-122.1,-122.5])
                        .range([0,300]);

            $.each(checkins, function(i, e) {
                var pt = [lat(e.venue.location.lat), lon(parseFloat(e.venue.location.lng))];
                points.push(pt);
            });

            console.log('points loaded:', points);

            update();
        }
	});
});

var main = d3.select("body").append("div")
            .attr("id","svg")
            .append("svg:svg")
            .attr("width","900px")
            .attr("height","400px");

var points;

var g = main.append("svg:g")
        .attr("id","delaunay");

function update(){
    g.selectAll("path")
    .data(d3.geom.delaunay(points))
    .enter().append("svg:path");

    g.selectAll("path")
        .attr("d", function(d) { return "M" + d.join("L") + "Z"; });
}

$("#output").click(function(){
    var code = $("#svg").html();
    $("body").append($("<div>").text(code));
})

</script>

</body>
</html>